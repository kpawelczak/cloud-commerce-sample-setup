import './polyfills.server.mjs';
import{a as ze,b as Yt,c as Xt,d as Jt,e as at,f as Wt,h as ei,i as He,j as ti,k as ii,l as ni,m as ri,n as oi,o as ci,p as si,q as ai,r as li,s as pi,t as di,v as I}from"./chunk-4TC7GTIP.mjs";import{H as Ht}from"./chunk-3GAOJBAD.mjs";import{B as Ut,Ba as st,C as ae,Ca as qe,I as Pe,Ia as Qt,J as Ve,K as Ue,La as qt,N as ye,Na as Kt,V as ot,X as Ge,Y as Se,Z as le,ab as Zt,b as we,bb as Ke,c as q,cb as zt,d as Le,e as je,f as nt,gc as Ze,i as J,l as Ne,ma as pe,o as rt,p as Be,ra as Gt,s as $e,t as $t,u as Pt,ua as ct,v as Vt,ya as Qe,za as be}from"./chunk-IRX6SEZP.mjs";import{Ea as Ot,Fb as et,Gb as Y,Hb as Lt,I as N,Ia as G,K as It,Lb as tt,Mb as xe,O as Dt,Oa as Ce,Qa as ve,Ra as Oe,Sb as jt,Tb as it,Ua as ne,Wb as Me,Xb as Ee,Y as Rt,Yb as Nt,Zb as Bt,ha as Ft,ja as At,jb as Mt,kb as wt,la as ie,lc as Q,mc as X,x as Je,z as We}from"./chunk-WYLVLNCF.mjs";import{$a as ee,$b as L,Aa as M,Bd as U,Fa as F,Ga as b,Gc as c,Hc as l,Ia as z,Ib as Re,Ic as D,Id as j,Ka as v,Kb as Fe,L as Tt,La as A,Lc as se,Pb as C,Pd as Xe,Qb as P,Ra as O,Rb as u,S as R,Sa as _,T as kt,Ta as xt,X as K,Xb as a,Xd as _t,Yb as s,Zb as f,_a as W,_b as w,a as re,ab as De,bc as te,ca as Ct,dc as x,ec as S,fb as Et,g as ht,hc as he,ia as vt,kb as yt,kc as fe,lc as Te,mc as ke,nc as ce,oc as m,pc as H,q as Ie,qc as g,r as ft,rc as Ye,td as bt,vd as Ae,wb as o,wd as V,x as k,xa as Z,xb as h,y as oe,yc as St,zc as E}from"./chunk-LKLG3K6D.mjs";import{a as ut,b as gt}from"./chunk-GHFNAT2I.mjs";var pt=["element"];function Oi(n,t){if(n&1){let d=te();a(0,"div",2)(1,"button",3,0),x("click",function(){W(d);let i=S();return ee(i.openDialog())}),m(3),c(4,"cxTranslate"),s()()}n&2&&(o(3),g(" ",l(4,1,"customerTicketingDetails.closeRequest")," "))}var ue=n=>({count:n});function Mi(n,t){n&1&&f(0,"cx-spinner",17)}function wi(n,t){if(n&1&&(a(0,"option",24),m(1),s()),n&2){let d=t.$implicit,e=S(2);u("ngValue",d)("selected",d.id===(e.selectedCategory==null?null:e.selectedCategory.id)),o(),g(" ",d.name," ")}}function Li(n,t){if(n&1&&(a(0,"label")(1,"span",9),m(2),c(3,"cxTranslate"),s(),a(4,"select",21)(5,"option",22),m(6),c(7,"cxTranslate"),s(),C(8,wi,2,3,"option",23),s(),f(9,"cx-form-errors",11),s()),n&2){let d=t.ngIf,e=S();o(2),g(" ",l(3,4,"createCustomerTicket.category")," "),o(4),g(" ",l(7,6,"createCustomerTicket.selectCategory")," "),o(2),u("ngForOf",d),o(),u("control",e.form.get("ticketCategory"))}}function ji(n,t){if(n&1&&(a(0,"option",24),m(1),s()),n&2){let d=t.$implicit,e=S(3);u("ngValue",d)("selected",d.code===(e.selectedAssociatedObject==null?null:e.selectedAssociatedObject.code)),o(),Ye(" ",d.type," ",d.code," ")}}function Ni(n,t){if(n&1&&(a(0,"label")(1,"span",9),m(2),c(3,"cxTranslate"),s(),a(4,"select",25)(5,"option",22),m(6),c(7,"cxTranslate"),s(),C(8,ji,2,4,"option",23),s()()),n&2){let d=S().ngIf;o(2),g(" ",l(3,3,"createCustomerTicket.associateTo")," "),o(4),g(" ",l(7,5,"createCustomerTicket.optionallySelectAssociatedObject")," "),o(2),u("ngForOf",d)}}function Bi(n,t){if(n&1&&(w(0),C(1,Ni,9,7,"label",13),L()),n&2){let d=t.ngIf;o(),u("ngIf",d.length>0)}}function $i(n,t){if(n&1&&(f(0,"cx-icon",6),a(1,"span",26),m(2),c(3,"cxTranslate"),s()),n&2){let d=S();u("type",d.iconTypes.UPLOAD),o(2),H(l(3,2,"customerTicketing.uploadFile"))}}function Pi(n,t){if(n&1&&(f(0,"cx-icon",6),a(1,"span",20),m(2),c(3,"cxTranslate"),s()),n&2){let d=S();u("type",d.iconTypes.UPLOAD),o(2),H(l(3,2,"customerTicketing.uploadFile"))}}function Vi(n,t){n&1&&f(0,"cx-spinner",21)}var de=n=>({ticketCode:n}),me=n=>({cxRoute:"supportTicketDetails",params:n});function Ui(n,t){if(n&1){let d=te();a(0,"tr",14),x("click",function(){let i=W(d).$implicit,r=S(3);return ee(r.goToTicketDetail(i.id))}),a(1,"td",15)(2,"div",16),m(3),c(4,"cxTranslate"),s(),a(5,"a",17),c(6,"cxUrl"),m(7),s()(),a(8,"td",18)(9,"div",16),m(10),c(11,"cxTranslate"),s(),a(12,"a",17),c(13,"cxUrl"),m(14),s()(),a(15,"td",18)(16,"div",16),m(17),c(18,"cxTranslate"),s(),a(19,"a",17),c(20,"cxUrl"),m(21),s()(),a(22,"td",18)(23,"div",16),m(24),c(25,"cxTranslate"),s(),a(26,"a",17),c(27,"cxUrl"),m(28),c(29,"cxDate"),s()(),a(30,"td",18)(31,"div",16),m(32),c(33,"cxTranslate"),s(),a(34,"a",17),c(35,"cxUrl"),m(36),c(37,"cxDate"),s()(),a(38,"td",18)(39,"div",16),m(40),c(41,"cxTranslate"),s(),a(42,"a",19),c(43,"cxUrl"),m(44),s()()()}if(n&2){let d=t.$implicit,e=S(3);o(3),g(" ",l(4,19,"customerTicketingList.mobile.ticketIdFull")," "),o(2),u("routerLink",l(6,21,E(49,me,E(47,de,d.id)))),o(2),g(" ",d.id," "),o(3),g(" ",l(11,23,"customerTicketingList.subject")," "),o(2),u("routerLink",l(13,25,E(53,me,E(51,de,d.id)))),o(2),g(" ",d.subject," "),o(3),g(" ",l(18,27,"customerTicketingList.ticketCategory")," "),o(2),u("routerLink",l(20,29,E(57,me,E(55,de,d.id)))),o(2),g(" ",d.ticketCategory==null?null:d.ticketCategory.name," "),o(3),g(" ",l(25,31,"customerTicketing.createdOn")," "),o(2),u("routerLink",l(27,33,E(61,me,E(59,de,d.id)))),o(2),g(" ",l(29,35,d.createdAt)," "),o(4),g(" ",l(33,37,"customerTicketing.changedOn")," "),o(2),u("routerLink",l(35,39,E(65,me,E(63,de,d.id)))),o(2),g(" ",l(37,41,d.modifiedAt)," "),o(4),g(" ",l(41,43,"customerTicketing.status")," "),o(2),u("routerLink",l(43,45,E(69,me,E(67,de,d.id))))("ngClass",e.getStatusClass(d.status.id)),o(2),g(" ",d.status==null?null:d.status.name," ")}}function Gi(n,t){if(n&1){let d=te();a(0,"div",20)(1,"cx-pagination",21),x("viewPageEvent",function(i){W(d);let r=S(3);return ee(r.pageChange(i))}),s()()}if(n&2){let d=S(2).ngIf;o(),u("pagination",d.pagination)}}function Qi(n,t){if(n&1){let d=te();w(0),a(1,"div",5)(2,"label",6)(3,"span"),m(4),c(5,"cxTranslate"),s(),a(6,"cx-sorting",7),c(7,"cxTranslate"),c(8,"async"),c(9,"cxTranslate"),x("sortListEvent",function(i){W(d);let r=S(2);return ee(r.changeSortCode(i))}),s()(),f(10,"cx-customer-ticketing-create"),s(),a(11,"table",8)(12,"thead",9)(13,"tr")(14,"th",10),m(15),c(16,"cxTranslate"),s(),a(17,"th",10),m(18),c(19,"cxTranslate"),s(),a(20,"th",10),m(21),c(22,"cxTranslate"),s(),a(23,"th",10),m(24),c(25,"cxTranslate"),s(),a(26,"th",10),m(27),c(28,"cxTranslate"),s(),a(29,"th",10),m(30),c(31,"cxTranslate"),s()()(),a(32,"tbody"),C(33,Ui,45,71,"tr",11),s()(),a(34,"div",12),C(35,Gi,2,1,"div",13),s(),L()}if(n&2){let d=S().ngIf,e=S();o(4),g(" ",l(5,14,"customerTicketingList.sortSubtitle")," "),o(2),he("placeholder",l(7,16,"customerTicketingList.sortSubtitle")),u("sortOptions",d.sorts)("sortLabels",l(8,18,e.getSortLabels()))("selectedOption",d.pagination==null?null:d.pagination.sort)("ariaLabel",l(9,20,"customerTicketingList.sortOrders")),o(9),H(l(16,22,"customerTicketing.ticketId")),o(3),g(" ",l(19,24,"customerTicketingList.subject")," "),o(3),g(" ",l(22,26,"customerTicketingList.ticketCategory")," "),o(3),H(l(25,28,"customerTicketing.createdOn")),o(3),H(l(28,30,"customerTicketing.changedOn")),o(3),H(l(31,32,"customerTicketing.status")),o(3),u("ngForOf",d.tickets),o(2),u("ngIf",(d.pagination==null?null:d.pagination.totalPages)>1)}}function qi(n,t){n&1&&(f(0,"cx-customer-ticketing-create"),w(1),a(2,"div",22)(3,"h3"),m(4),c(5,"cxTranslate"),s()(),L()),n&2&&(o(4),H(l(5,1,"customerTicketingList.noTickets")))}function Ki(n,t){if(n&1&&(w(0),a(1,"span",3)(2,"h2",4),m(3),c(4,"cxTranslate"),s()(),C(5,Qi,36,34,"ng-container",2)(6,qi,6,3,"ng-template",null,1,se),L()),n&2){let d=t.ngIf,e=ce(7);o(3),Ye(" ",l(4,4,"customerTicketingList.requestTitle")," (",(d.pagination==null?null:d.pagination.totalResults)||0,") "),o(2),u("ngIf",d.tickets.length>0)("ngIfElse",e)}}function Zi(n,t){n&1&&f(0,"cx-spinner")}function zi(n,t){if(n&1&&(w(0),a(1,"div",2)(2,"div",3)(3,"div",4),f(4,"cx-card",5),c(5,"async"),s(),a(6,"div",4),f(7,"cx-card",5),c(8,"cxDate"),c(9,"async"),s(),a(10,"div",4),f(11,"cx-card",5),c(12,"cxDate"),c(13,"async"),s(),a(14,"div",4),f(15,"cx-card",5),c(16,"async"),s()()(),L()),n&2){let d,e,i=t.ngIf,r=S();o(4),u("content",l(5,4,r.prepareCardContent(i.id,"customerTicketing.ticketId"))),o(3),u("content",l(9,9,r.prepareCardContent((d=D(8,6,i.createdAt,r.dateFormat))!==null&&d!==void 0?d:r.dateFormat,"customerTicketing.createdOn"))),o(4),u("content",l(13,14,r.prepareCardContent((e=D(12,11,i.modifiedAt,r.dateFormat))!==null&&e!==void 0?e:r.dateFormat,"customerTicketing.changedOn"))),o(4),u("content",l(16,16,r.prepareCardContent(i.status?i.status.name:void 0,"customerTicketing.status",i.status?i.status.id:void 0)))}}function Hi(n,t){n&1&&f(0,"cx-spinner")}function Yi(n,t){if(n&1){let d=te();a(0,"div",2)(1,"button",3,0),x("click",function(){W(d);let i=S();return ee(i.openDialog())}),m(3),c(4,"cxTranslate"),s()()}n&2&&(o(3),g(" ",l(4,1,"customerTicketingDetails.reopenRequest")," "))}var Xi=()=>({cxRoute:"supportTickets"}),mi=n=>({value:n});function Ji(n,t){if(n&1&&(w(0),a(1,"div",9)(2,"span",10),c(3,"cxTranslate"),m(4),s(),a(5,"span",11),m(6),s(),a(7,"span",11),c(8,"cxTranslate"),m(9),c(10,"cxTranslate"),s()(),a(11,"div",11),m(12),c(13,"cxDate"),c(14,"cxTranslate"),s(),L()),n&2){let d=t.$implicit;o(2),P("aria-label",l(3,6,"myAccountV2CustomerTicketing.subjectLabel")),o(2),g(" ",d.subject," "),o(2),g(" | ",d.ticketCategory==null?null:d.ticketCategory.name," "),o(),P("aria-label",l(8,8,"myAccountV2CustomerTicketing.idLabel")),o(2),g(" | ",D(10,10,"myAccountV2CustomerTicketing.ticketId",E(19,mi,d.id))," "),o(3),g(" ",D(14,16,"myAccountV2CustomerTicketing.changedOn",E(21,mi,D(13,13,d.modifiedAt,"d, MMMM, yyyy")))," ")}}function Wi(n,t){if(n&1&&(w(0),a(1,"div",7),C(2,Ji,15,23,"ng-container",8),s(),L()),n&2){let d=S().ngIf;o(2),u("ngForOf",d.tickets)}}function en(n,t){if(n&1&&(w(0),C(1,Wi,3,1,"ng-container",6),L()),n&2){let d=t.ngIf;S();let e=ce(15);o(),u("ngIf",d.tickets.length>0)("ngIfElse",e)}}function tn(n,t){n&1&&(a(0,"div",12),c(1,"cxTranslate"),m(2),c(3,"cxTranslate"),s()),n&2&&(P("aria-label",l(1,2,"customerTicketingList.noTickets")),o(2),g(" ",l(3,4,"customerTicketingList.noTickets")," "))}function nn(n,t){n&1&&f(0,"cx-spinner")}var gi=(()=>{let t=class t{constructor(){this.customerTicketingFacade=A(I)}enableCloseButton(){return this.customerTicketingFacade.getTicket().pipe(k(e=>(e?.status?.id==="OPEN"||e?.status?.id==="INPROCESS")&&e.availableStatusTransitions?.some(i=>i.id.toUpperCase()==="CLOSED")))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=F({token:t,factory:t.\u0275fac});let n=t;return n})(),rn=(()=>{let t=class t{constructor(e,i,r){this.customerTicketingFacade=e,this.launchDialogService=i,this.vcr=r,this.subscription=new re,this.customerTicketingCloseComponentService=A(gi),this.enableCloseButton$=this.customerTicketingCloseComponentService.enableCloseButton()}openDialog(){let e=this.launchDialogService.openDialog("CUSTOMER_TICKETING_CLOSE",this.element,this.vcr);e&&this.subscription.add(e.pipe(K(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(h(I),h(ye),h(Re))},t.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-close"]],viewQuery:function(i,r){if(i&1&&fe(pt,5),i&2){let p;Te(p=ke())&&(r.element=p.first)}},decls:2,vars:3,consts:[["element",""],["class","col-xs-12 col-md-5 col-lg-4",4,"ngIf"],[1,"col-xs-12","col-md-5","col-lg-4"],[1,"btn","btn-block","btn-secondary",3,"click"]],template:function(i,r){i&1&&(C(0,Oi,5,3,"div",1),c(1,"async")),i&2&&u("ngIf",l(1,1,r.enableCloseButton$))},dependencies:[V,U,Q],encapsulation:2});let n=t;return n})(),dt=(()=>{let t=class t{get messagesCharacterLeft(){return this.inputCharactersLimit-(this.form.get("message")?.value?.length||0)}get subjectCharacterLeft(){return this.inputCharactersForSubject-(this.form.get("subject")?.value?.length||0)}get allowedTypes(){return this.customerTicketingConfig.customerTicketing?.attachmentRestrictions?.allowedTypes}get getInputCharactersLimit(){return this.customerTicketingConfig.customerTicketing?.inputCharactersLimit??Yt}get getInputCharactersForSubject(){return this.customerTicketingConfig.customerTicketing?.inputCharactersLimitForSubject??Xt}get maxSize(){return this.customerTicketingConfig.customerTicketing?.attachmentRestrictions?.maxSize??Jt}handleClick(e){e.target.tagName===this.el.nativeElement.tagName&&this.close("Click outside of the window")}constructor(e,i,r,p,T,B){this.launchDialogService=e,this.el=i,this.customerTicketingConfig=r,this.filesFormValidators=p,this.customerTicketingFacade=T,this.routingService=B,this.iconTypes=ot,this.inputCharactersLimit=this.getInputCharactersLimit,this.inputCharactersForSubject=this.getInputCharactersForSubject,this.isDataLoading$=new ht(!1),this.focusConfig={trap:!0,block:!0,autofocus:"button",focusOnEscape:!0}}buildForm(){let e=new nt({});e.setControl("message",new J("",[q.required,q.maxLength(this.inputCharactersLimit)])),e.setControl("file",new J("",[this.filesFormValidators.maxSize(this.maxSize),this.filesFormValidators.maxEntries(at),this.filesFormValidators.allowedTypes(this.allowedTypes)])),this.form=e}close(e){this.launchDialogService.closeDialog(e)}};t.\u0275fac=function(i){return new(i||t)(h(ye),h(Et),h(ze),h(Zt),h(I),h(ie))},t.\u0275dir=xt({type:t,hostBindings:function(i,r){i&1&&x("click",function(T){return r.handleClick(T)})}});let n=t;return n})(),on=(()=>{let t=class t extends dt{ngOnInit(){this.buildForm()}closeRequest(){this.form.invalid?(this.form.markAllAsTouched(),Ze.deepUpdateValueAndValidity(this.form)):(this.isDataLoading$.next(!0),this.subscription=this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent()).subscribe({complete:()=>{this.onComplete()},error:()=>{this.onError()}}))}prepareTicketEvent(){return{message:this.form?.get("message")?.value,toStatus:{id:"CLOSED",name:"Closed"}}}onComplete(){this.isDataLoading$.next(!1),this.close("Ticket closed successfully"),this.routingService.go({cxRoute:"supportTickets"})}onError(){this.close("Something went wrong while closing the ticket"),this.isDataLoading$.next(!1)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}};t.\u0275fac=(()=>{let e;return function(r){return(e||(e=De(t)))(r||t)}})(),t.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-close-dialog"]],features:[Fe],decls:31,vars:32,consts:[["role","dialog","aria-labelledby","dialogTitle",1,"cx-customer-ticket-form-dialog",3,"esc","cxFocus"],[1,"cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],["id","dialogTitle",1,"cx-customer-ticket-form-title","modal-title"],[1,"cx-customer-ticket-form-close","close",3,"click","title"],["aria-hidden","true"],[3,"type"],[1,"cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["formControlName","message","rows","5",1,"form-control",3,"maxLength"],[3,"control"],[1,"cx-customer-ticket-input-hint"],[1,"cx-customer-ticket-form-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"],["class","overlay",4,"ngIf"],[1,"overlay"]],template:function(i,r){i&1&&(a(0,"div",0),x("esc",function(){return r.close("Escape clicked")}),a(1,"form",1)(2,"div",2)(3,"div",3),m(4),c(5,"cxTranslate"),s(),a(6,"button",4),c(7,"cxTranslate"),c(8,"cxTranslate"),x("click",function(){return r.close("Close Request Dialog")}),a(9,"span",5),f(10,"cx-icon",6),s()()(),a(11,"div",7)(12,"div",8)(13,"label")(14,"span",9),m(15),c(16,"cxTranslate"),s(),f(17,"textarea",10)(18,"cx-form-errors",11),a(19,"p",12),m(20),c(21,"cxTranslate"),s()()(),a(22,"div",13)(23,"button",14),x("click",function(){return r.close("Close Request Dialog")}),m(24),c(25,"cxTranslate"),s(),a(26,"button",15),x("click",function(){return r.closeRequest()}),m(27),c(28,"cxTranslate"),s()()(),C(29,Mi,1,0,"cx-spinner",16),c(30,"async"),s()()),i&2&&(u("cxFocus",r.focusConfig),o(),u("formGroup",r.form),o(3),g(" ",l(5,13,"customerTicketingDetails.closeRequest")," "),o(2),he("title",l(7,15,"common.close")),P("aria-label",l(8,17,"common.close")),o(4),u("type",r.iconTypes.CLOSE),o(5),g(" ",l(16,19,"customerTicketing.message")," "),o(2),u("maxLength",r.inputCharactersLimit),o(),u("control",r.form.get("message")),o(2),g(" ",D(21,21,"customerTicketing.charactersLeft",E(30,ue,r.messagesCharacterLeft))," "),o(4),g(" ",l(25,24,"customerTicketing.cancel")," "),o(3),g(" ",l(28,26,"customerTicketing.submit")," "),o(2),u("ngIf",l(30,28,r.isDataLoading$)))},dependencies:[V,Ge,Pe,Ne,we,Le,je,Be,$e,Qe,le,U,Q],encapsulation:2});let n=t;return n})(),cn=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({providers:[gi,N({cmsComponents:{SupportTicketCloseComponent:{component:rn,guards:[ne]}}})],imports:[j,X,Se,Ve,ae,be,qe,pe]});let n=t;return n})(),sn=(()=>{let t=class t extends dt{constructor(){super(...arguments),this.ticketCategories$=this.customerTicketingFacade.getTicketCategories().pipe(M(e=>{this.manageCategoryValidation(e)})),this.ticketAssociatedObjects$=this.customerTicketingFacade.getTicketAssociatedObjects().pipe(R(e=>(this.handleError(e),Ie([])))),this.globalMessage=A(Oe),this.translationService=A(Y)}getCreateTicketPayload(e){return{message:e?.get("message")?.value,subject:e?.get("subject")?.value,associatedTo:e?.get("associatedTo")?.value||void 0,ticketCategory:e?.get("ticketCategory")?.value}}ngOnInit(){this.buildForm()}buildForm(){let e=new nt({});e.setControl("subject",new J("",[q.required,q.maxLength(this.inputCharactersForSubject)])),e.setControl("ticketCategory",new J("",[q.required])),e.setControl("associatedTo",new J("")),e.setControl("message",new J("",[q.required,q.maxLength(this.inputCharactersLimit)])),e.setControl("file",new J("",[this.filesFormValidators.maxSize(this.maxSize),this.filesFormValidators.maxEntries(at),this.filesFormValidators.allowedTypes(this.allowedTypes)])),this.form=e}createTicketRequest(){this.attachment=this.form.get("file")?.value?.[0],this.form.invalid?(this.form.markAllAsTouched(),Ze.deepUpdateValueAndValidity(this.form)):this.subscription=this.customerTicketingFacade.createTicket(this.getCreateTicketPayload(this.form)).subscribe({next:e=>{e.id&&this.attachment&&e.ticketEvents?.[0].code&&this.customerTicketingFacade.uploadAttachment(this.attachment,e.ticketEvents?.[0].code,e.id)},complete:()=>{this.onComplete()},error:e=>{this.handleError(e)}})}handleError(e){e instanceof Dt?(e.details??[]).forEach(i=>{i.message&&this.globalMessage.add({raw:i.message},ve.MSG_TYPE_ERROR)}):this.translationService.translate("httpHandlers.unknownError").pipe(vt()).subscribe(i=>{this.globalMessage.add({raw:i},ve.MSG_TYPE_ERROR)}),this.onError()}manageCategoryValidation(e){let i=this.form.get("ticketCategory");i&&(e?.length?(i.setValidators(q.required),i.updateValueAndValidity()):(i.clearValidators(),i.updateValueAndValidity()))}onComplete(){this.close("Ticket created successfully")}onError(){this.close("Something went wrong")}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}};t.\u0275fac=(()=>{let e;return function(r){return(e||(e=De(t)))(r||t)}})(),t.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-create-dialog"]],inputs:{selectedCategory:"selectedCategory",selectedAssociatedObject:"selectedAssociatedObject"},features:[Fe],decls:52,vars:58,consts:[["role","dialog","aria-labelledby","dialogTitle",1,"cx-customer-ticket-form-dialog",3,"esc","cxFocus"],[1,"cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],["id","dialogTitle",1,"cx-customer-ticket-form-title","modal-title"],["type","button",1,"cx-customer-ticket-form-close","close",3,"click","title"],["aria-hidden","true"],[3,"type"],[1,"cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["formControlName","subject","rows","1",1,"form-control",3,"maxLength"],[3,"control"],[1,"cx-customer-ticket-input-hint"],[4,"ngIf"],["formControlName","message","rows","5",1,"form-control",3,"maxLength"],[3,"formControl","accept"],[1,"cx-customer-ticket-file-upload-hint"],["prefix","formErrors.file",3,"control"],[1,"cx-customer-ticket-form-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["formControlName","ticketCategory",1,"form-control"],["value","","disabled","","selected",""],[3,"ngValue","selected",4,"ngFor","ngForOf"],[3,"ngValue","selected"],["formControlName","associatedTo",1,"form-control"],[1,"cx-message-footer-text"]],template:function(i,r){i&1&&(a(0,"div",0),x("esc",function(){return r.close("Escape clicked")}),a(1,"form",1)(2,"div",2)(3,"div",3),m(4),c(5,"cxTranslate"),s(),a(6,"button",4),c(7,"cxTranslate"),c(8,"cxTranslate"),x("click",function(){return r.close("Close Create Request Dialog")}),a(9,"span",5),f(10,"cx-icon",6),s()()(),a(11,"div",7)(12,"div",8)(13,"label")(14,"span",9),m(15),c(16,"cxTranslate"),s(),f(17,"textarea",10)(18,"cx-form-errors",11),a(19,"p",12),m(20),c(21,"cxTranslate"),s()(),C(22,Li,10,8,"label",13),c(23,"async"),C(24,Bi,2,1,"ng-container",13),c(25,"async"),a(26,"label")(27,"span",9),m(28),c(29,"cxTranslate"),s(),f(30,"textarea",14)(31,"cx-form-errors",11),a(32,"p",12),m(33),c(34,"cxTranslate"),s()(),a(35,"div")(36,"cx-file-upload",15),C(37,$i,4,4,"ng-template"),s(),a(38,"p",16),m(39),c(40,"cxTranslate"),s(),a(41,"p",16),m(42),c(43,"cxTranslate"),s(),f(44,"cx-form-errors",17),s()(),a(45,"div",18)(46,"button",19),x("click",function(){return r.close("Close Create Request Dialog")}),m(47),c(48,"cxTranslate"),s(),a(49,"button",20),x("click",function(){return r.createTicketRequest()}),m(50),c(51,"cxTranslate"),s()()()()()),i&2&&(u("cxFocus",r.focusConfig),o(),u("formGroup",r.form),o(3),g(" ",l(5,23,"createCustomerTicket.addNewRequest")," "),o(2),he("title",l(7,25,"common.close")),P("aria-label",l(8,27,"common.close")),o(4),u("type",r.iconTypes.CLOSE),o(5),g(" ",l(16,29,"createCustomerTicket.subject")," "),o(2),u("maxLength",r.inputCharactersForSubject),o(),u("control",r.form.get("subject")),o(2),g(" ",D(21,31,"customerTicketing.charactersLeft",E(52,ue,r.subjectCharacterLeft))," "),o(2),u("ngIf",l(23,34,r.ticketCategories$)),o(2),u("ngIf",l(25,36,r.ticketAssociatedObjects$)),o(4),g(" ",l(29,38,"customerTicketing.message")," "),o(2),u("maxLength",r.inputCharactersLimit),o(),u("control",r.form.get("message")),o(2),g(" ",D(34,40,"customerTicketing.charactersLeft",E(54,ue,r.messagesCharacterLeft))," "),o(3),u("formControl",r.form.get("file"))("accept",r.allowedTypes),o(3),g(" ",D(40,43,"customerTicketing.fileSizeLimit",E(56,ue,r.maxSize))," "),o(3),g(" ",l(43,46,"customerTicketing.maximumAttachment")," "),o(2),u("control",r.form.get("file")),o(3),g(" ",l(48,48,"customerTicketing.cancel")," "),o(3),g(" ",l(51,50,"customerTicketing.submit")," "))},dependencies:[Ae,V,Ge,Pe,Ne,Pt,Vt,we,$t,Le,je,rt,Be,$e,Qe,st,U,Q],encapsulation:2});let n=t;return n})(),an=(()=>{let t=class t{constructor(e,i){this.launchDialogService=e,this.vcr=i,this.subscription=new re}openCreateNewTicketDialog(){let e=this.launchDialogService.openDialog("CUSTOMER_TICKETING_CREATE",this.element,this.vcr);e&&this.subscription.add(e.pipe(K(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(h(ye),h(Re))},t.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-create"]],viewQuery:function(i,r){if(i&1&&fe(pt,5),i&2){let p;Te(p=ke())&&(r.element=p.first)}},decls:4,vars:3,consts:[["element",""],[1,"btn","btn-primary","cx-customer-ticketing-create",3,"click"]],template:function(i,r){if(i&1){let p=te();a(0,"button",1,0),x("click",function(){return W(p),ee(r.openCreateNewTicketDialog())}),m(2),c(3,"cxTranslate"),s()}i&2&&(o(2),g(" ",l(3,1,"createCustomerTicket.addRequest"),`
`))},dependencies:[Q],encapsulation:2});let n=t;return n})(),hi=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({imports:[j,X,Se,Ve,ae,be,qe]});let n=t;return n})(),ln=(()=>{let t=class t extends dt{ngOnInit(){this.buildForm()}reopenRequest(){if(this.form.invalid)this.form.markAllAsTouched(),Ze.deepUpdateValueAndValidity(this.form);else{let e=this.form.get("file")?.value?.length>0;this.isDataLoading$.next(!0),this.subscription=this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent(),e).subscribe({next:i=>{this.form.get("file")?.value?.length&&i.code&&this.customerTicketingFacade.uploadAttachment(this.form.get("file")?.value?.item(0),i.code)},complete:()=>{this.onComplete()},error:()=>{this.onError()}})}}onComplete(){this.isDataLoading$.next(!1),this.close("Ticket reopened successfully")}onError(){this.isDataLoading$.next(!1),this.close("Something went wrong while reopening ticket")}prepareTicketEvent(){return{message:this.form?.get("message")?.value,toStatus:{id:"INPROCESS",name:"INPROCESS"}}}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}};t.\u0275fac=(()=>{let e;return function(r){return(e||(e=De(t)))(r||t)}})(),t.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-reopen-dialog"]],features:[Fe],decls:41,vars:44,consts:[["role","dialog","aria-labelledby","dialogTitle",1,"cx-customer-ticket-form-dialog",3,"esc","cxFocus"],[1,"cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],["id","dialogTitle",1,"cx-customer-ticket-form-title","modal-title"],["type","button",1,"cx-customer-ticket-form-close","close",3,"click","title"],["aria-hidden","true"],[3,"type"],[1,"cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["formControlName","message","rows","5",1,"form-control",3,"maxLength"],[3,"control"],[1,"cx-customer-ticket-input-hint"],[3,"formControl","accept"],[1,"cx-customer-ticket-file-upload-hint"],["prefix","formErrors.file",3,"control"],[1,"cx-customer-ticket-form-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["class","overlay",4,"ngIf"],[1,"cx-message-footer-text"],[1,"overlay"]],template:function(i,r){i&1&&(a(0,"div",0),x("esc",function(){return r.close("Escape clicked")}),a(1,"form",1)(2,"div",2)(3,"div",3),m(4),c(5,"cxTranslate"),s(),a(6,"button",4),c(7,"cxTranslate"),c(8,"cxTranslate"),x("click",function(){return r.close("Close Reopen Request Dialog")}),a(9,"span",5),f(10,"cx-icon",6),s()()(),a(11,"div",7)(12,"div",8)(13,"label")(14,"span",9),m(15),c(16,"cxTranslate"),s(),f(17,"textarea",10)(18,"cx-form-errors",11),a(19,"p",12),m(20),c(21,"cxTranslate"),s()()(),a(22,"div")(23,"cx-file-upload",13),C(24,Pi,4,4,"ng-template"),s(),a(25,"p",14),m(26),c(27,"cxTranslate"),s(),a(28,"p",14),m(29),c(30,"cxTranslate"),s(),f(31,"cx-form-errors",15),s(),a(32,"div",16)(33,"button",17),x("click",function(){return r.close("Close Reopen Request Dialog")}),m(34),c(35,"cxTranslate"),s(),a(36,"button",18),x("click",function(){return r.reopenRequest()}),m(37),c(38,"cxTranslate"),s()()(),C(39,Vi,1,0,"cx-spinner",19),c(40,"async"),s()()),i&2&&(u("cxFocus",r.focusConfig),o(),u("formGroup",r.form),o(3),g(" ",l(5,18,"customerTicketingDetails.reopenRequest")," "),o(2),he("title",l(7,20,"common.close")),P("aria-label",l(8,22,"common.close")),o(4),u("type",r.iconTypes.CLOSE),o(5),g(" ",l(16,24,"customerTicketing.message")," "),o(2),u("maxLength",r.inputCharactersLimit),o(),u("control",r.form.get("message")),o(2),g(" ",D(21,26,"customerTicketing.charactersLeft",E(40,ue,r.messagesCharacterLeft))," "),o(3),u("formControl",r.form.get("file"))("accept",r.allowedTypes),o(3),g(" ",D(27,29,"customerTicketing.fileSizeLimit",E(42,ue,r.maxSize))," "),o(3),g(" ",l(30,32,"customerTicketing.maximumAttachment")," "),o(2),u("control",r.form.get("file")),o(3),g(" ",l(35,34,"customerTicketing.cancel")," "),o(3),g(" ",l(38,36,"customerTicketing.submit")," "),o(2),u("ngIf",l(40,38,r.isDataLoading$)))},dependencies:[V,Ge,Pe,Ne,we,Le,je,rt,Be,$e,Qe,st,le,U,Q],encapsulation:2});let n=t;return n})(),pn={launch:{CUSTOMER_TICKETING_REOPEN:{inline:!0,component:ln,dialogType:Ue.DIALOG},CUSTOMER_TICKETING_CLOSE:{inline:!0,component:on,dialogType:Ue.DIALOG},CUSTOMER_TICKETING_CREATE:{inline:!0,component:sn,dialogType:Ue.DIALOG}}},dn=(()=>{let t=class t{constructor(e,i,r,p){this.customerTicketingFacade=e,this.routingService=i,this.translationService=r,this.customerTicketingConfig=p,this.PAGE_SIZE=this.customerTicketingConfig.customerTicketing?.listViewPageSize||5,this.iconTypes=ot,this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE).pipe(M(T=>this.sortType=T?.pagination?.sort||"")),this.getStatusClass=T=>{switch(T){case"OPEN":case"INPROCESS":return"cx-text-green";case"CLOSED":return"cx-text-grey";default:return""}}}goToTicketDetail(e){this.routingService.go({cxRoute:"supportTicketDetails",params:{ticketCode:e}})}getSortLabels(){return oe([this.translationService.translate("customerTicketing.ticketId"),this.translationService.translate("customerTicketing.changedOn")]).pipe(k(([e,i])=>({byTicketId:e,byDate:i})))}changeSortCode(e){this.sortType=e,this.pageChange(0)}pageChange(e){let i=this.createTicketListEvent(this.sortType,e);this.fetchTicketList(i)}createTicketListEvent(e,i){return{currentPage:i,sortCode:e}}fetchTicketList(e){this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE,e.currentPage,e.sortCode)}};t.\u0275fac=function(i){return new(i||t)(h(I),h(ie),h(Y),h(ze))},t.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-list"]],decls:4,vars:4,consts:[["spinner",""],["noCustomerTickets",""],[4,"ngIf","ngIfElse"],[1,"cx-ticketing-list-title"],[1,"cx-ticketing-list-title-text"],[1,"cx-ticketing-list-sort","top"],[1,"cx-ticketing-list-form-group","form-group"],["ariaControls","ticketing-list-table",3,"sortListEvent","sortOptions","sortLabels","selectedOption","placeholder","ariaLabel"],["id","ticketing-list-table","aria-hidden","true",1,"table","cx-ticketing-list-table"],[1,"cx-ticketing-list-thead-mobile"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[1,"cx-ticketing-list-sort","bottom"],["class","cx-ticketing-list-pagination",4,"ngIf"],[3,"click"],[1,"cx-ticketing-list-data","cx-ticketing-list-id"],[1,"cx-ticketing-list-label"],[1,"cx-ticketing-list-value",3,"routerLink"],[1,"cx-ticketing-list-data"],[1,"cx-ticketing-list-value",3,"routerLink","ngClass"],[1,"cx-ticketing-list-pagination"],[3,"viewPageEvent","pagination"],[1,"text-center"]],template:function(i,r){if(i&1&&(C(0,Ki,8,6,"ng-container",2),c(1,"async"),C(2,Zi,1,0,"ng-template",null,0,se)),i&2){let p=ce(3);u("ngIf",l(1,2,r.tickets$))("ngIfElse",p)}},dependencies:[an,bt,Ae,V,Qt,qt,Je,le,U,Q,Me,tt],encapsulation:2});let n=t;return n})(),mn=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({providers:[N({cmsComponents:{SupportTicketHistoryComponent:{component:dn,guards:[ne]}}})],imports:[hi,j,X,xe,ct,Se,Kt,We,pe]});let n=t;return n})(),un=(()=>{let t=class t{constructor(e,i,r,p){this.translation=e,this.customerTicketingFacade=i,this.routingService=r,this.eventService=p,this.dateFormat=Wt,this.subscription=new re,this.ticketDetails$=this.customerTicketingFacade.getTicket(),this.reloadOnRedirection()}prepareCardContent(e,i,r){return this.translation.translate(i).pipe(Tt(()=>!!e),k(p=>({title:p,text:[e||""],customClass:this.getStatusClass(r?.toUpperCase())})))}getStatusClass(e){return e==="OPEN"||e==="INPROCESS"?"cx-text-green":e==="CLOSED"?"cx-text-grey":""}reloadOnRedirection(){this.subscription=oe([this.ticketDetails$,this.routingService.getParams().pipe(k(e=>e.ticketCode))]).pipe(K(1),M(([e,i])=>{e&&i!==e?.id&&this.eventService.dispatch({},He)})).subscribe()}ngOnDestroy(){this.subscription?.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(h(Y),h(I),h(ie),h(Ce))},t.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-details"]],decls:4,vars:4,consts:[["spinner",""],[4,"ngIf","ngIfElse"],[1,"cx-ticket-details"],[1,"container"],[1,"cx-details-card"],[3,"content"]],template:function(i,r){if(i&1&&(C(0,zi,17,18,"ng-container",1),c(1,"async"),C(2,Hi,1,0,"ng-template",null,0,se)),i&2){let p=ce(3);u("ngIf",l(1,2,r.ticketDetails$))("ngIfElse",p)}},dependencies:[V,Gt,le,U,Me],encapsulation:2,changeDetection:0});let n=t;return n})(),gn=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({providers:[N({cmsComponents:{SupportTicketDetailsComponent:{component:un,guards:[ne]}}})],imports:[j,X,xe,ct,pe]});let n=t;return n})(),fi=(()=>{let t=class t{constructor(){this.customerTicketingFacade=A(I)}enableReopenButton(){return this.customerTicketingFacade.getTicket().pipe(k(e=>e?.status?.id==="CLOSED"&&e.availableStatusTransitions?.some(i=>i.id.toUpperCase()==="INPROCESS"||i.id.toUpperCase()==="OPEN")))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=F({token:t,factory:t.\u0275fac});let n=t;return n})(),hn=(()=>{let t=class t{constructor(e,i,r){this.customerTicketingFacade=e,this.launchDialogService=i,this.vcr=r,this.subscription=new re,this.CustomerTicketingReopenComponentService=A(fi),this.enableReopenButton$=this.CustomerTicketingReopenComponentService.enableReopenButton()}openDialog(){let e=this.launchDialogService.openDialog("CUSTOMER_TICKETING_REOPEN",this.element,this.vcr);e&&this.subscription.add(e.pipe(K(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(h(I),h(ye),h(Re))},t.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-reopen"]],viewQuery:function(i,r){if(i&1&&fe(pt,5),i&2){let p;Te(p=ke())&&(r.element=p.first)}},decls:2,vars:3,consts:[["element",""],["class","col-xs-12 col-md-5 col-lg-4",4,"ngIf"],[1,"col-xs-12","col-md-5","col-lg-4"],[1,"btn","btn-block","btn-secondary",3,"click"]],template:function(i,r){i&1&&(C(0,Yi,5,3,"div",1),c(1,"async")),i&2&&u("ngIf",l(1,1,r.enableReopenButton$))},dependencies:[V,U,Q],encapsulation:2});let n=t;return n})(),fn=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({providers:[fi,N({cmsComponents:{SupportTicketReopenComponent:{component:hn,guards:[ne]}}})],imports:[j,X,Se,Ve,ae,be,qe,pe]});let n=t;return n})(),Ti=(()=>{let t=class t{displayAddMessageSection(e){return e?.status?.id!=="CLOSED"}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=F({token:t,factory:t.\u0275fac});let n=t;return n})(),Tn=(()=>{let t=class t{constructor(e,i,r){this.customerTicketingConfig=e,this.customerTicketingFacade=i,this.eventService=r,this.customerTicketingMessagesComponentService=A(Ti),this.ticketDetails$=this.customerTicketingFacade.getTicket(),this.subscription=new re,this.messageEvents$=this.prepareMessageEvents(),this.messagingConfigs=this.prepareMessagingConfigs()}onSend(e){let i=(e.files instanceof FileList&&e.files?.length>0)??!1;this.subscription.add(this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent(e.message),i).subscribe(r=>{e.files&&e.files?.length&&r.code&&this.customerTicketingFacade.uploadAttachment(e.files.item(0),r.code),this.messagingComponent?.resetForm()}))}downloadAttachment(e){this.subscription.add(this.customerTicketingFacade.downloadAttachment(e.messageCode,e.attachmentId).subscribe(i=>{let r=window.URL.createObjectURL(i),p=document.createElement("a");p.href=r,p.download=e.fileName??"",p.click()}))}prepareMessageEvents(){return this.ticketDetails$.pipe(k(e=>e?.ticketEvents?.map(i=>gt(ut({},i),{text:i.message??"",rightAlign:i.addedByAgent||!1,attachments:i.ticketEventAttachments??[]}))??[]))}prepareMessagingConfigs(){return{attachmentRestrictions:this.customerTicketingConfig.customerTicketing?.attachmentRestrictions,charactersLimit:this.customerTicketingConfig.customerTicketing?.inputCharactersLimit,enableFileUploadOption:!0,displayAddMessageSection:this.ticketDetails$.pipe(k(e=>this.customerTicketingMessagesComponentService.displayAddMessageSection(e)))}}prepareTicketEvent(e){return{message:e}}ngOnDestroy(){this.subscription?.unsubscribe()}};t.\u0275fac=function(i){return new(i||t)(h(ze),h(I),h(Ce))},t.\u0275cmp=O({type:t,selectors:[["cx-customer-ticketing-messages"]],viewQuery:function(i,r){if(i&1&&fe(Ke,5),i&2){let p;Te(p=ke())&&(r.messagingComponent=p.first)}},decls:1,vars:2,consts:[[3,"send","downloadAttachment","messageEvents$","messagingConfigs"]],template:function(i,r){i&1&&(a(0,"cx-messaging",0),x("send",function(T){return r.onSend(T)})("downloadAttachment",function(T){return r.downloadAttachment(T)}),s()),i&2&&u("messageEvents$",r.messageEvents$)("messagingConfigs",r.messagingConfigs)},dependencies:[Ke],encapsulation:2});let n=t;return n})(),kn=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({providers:[Ti,N({cmsComponents:{SupportTicketUpdateComponent:{component:Tn,guards:[ne]}}})],imports:[j,X,xe,zt,ae,Ut]});let n=t;return n})(),Cn=(()=>{let t=class t{constructor(){this.PAGE_SIZE=1,this.customerTicketingFacade=A(I),this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE)}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=O({type:t,selectors:[["cx-my-account-v2-customer-ticketing"]],decls:18,vars:20,consts:[["noCustomerTickets",""],["spinner",""],[1,"cx-my-account-customer-ticket-header"],[1,"cx-my-account-customer-ticket-heading"],[1,"cx-my-account-customer-ticket-show-more"],["id","show-more-requests",1,"btn-link","cx-action-link",3,"routerLink"],[4,"ngIf","ngIfElse"],[1,"cx-my-account-customer-ticket-body"],[4,"ngFor","ngForOf"],[1,"cx-my-account-customer-ticket-details"],[1,"cx-my-account-customer-ticket-subject"],[1,"cx-my-account-customer-ticket-details-light"],[1,"cx-my-account-no-ticket"]],template:function(i,r){if(i&1&&(w(0),a(1,"div",2)(2,"div",3),c(3,"cxTranslate"),m(4),c(5,"cxTranslate"),s(),a(6,"div",4)(7,"a",5),c(8,"cxUrl"),c(9,"cxTranslate"),m(10),c(11,"cxTranslate"),s()()(),C(12,en,2,2,"ng-container",6),c(13,"async"),L(),C(14,tn,4,6,"ng-template",null,0,se)(16,nn,1,0,"ng-template",null,1,se)),i&2){let p=ce(17);o(2),P("aria-label",l(3,7,"myAccountV2CustomerTicketing.heading")),o(2),g(" ",l(5,9,"myAccountV2CustomerTicketing.heading")," "),o(3),u("routerLink",l(8,11,St(19,Xi))),P("aria-label",l(9,13,"myAccountV2CustomerTicketing.showMore")),o(3),g(" ",l(11,15,"myAccountV2CustomerTicketing.showMore")," "),o(2),u("ngIf",l(13,17,r.tickets$))("ngIfElse",p)}},dependencies:[Ae,V,le,Je,U,Q,Me,tt],encapsulation:2});let n=t;return n})(),vn=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({providers:[N({cmsComponents:{MyAccountViewRequestsComponent:{component:Cn,guards:[ne]}}})],imports:[j,X,xe,pe,We]});let n=t;return n})(),ki=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({providers:[N(pn)],imports:[ae,be,gn,cn,fn,mn,kn,hi,vn]});let n=t;return n})();var _e=class{},Ei=(()=>{let t=class t{constructor(e){this.adapter=e}getTicket(e,i){return this.adapter.getTicket(e,i)}getTickets(e,i,r,p){return this.adapter.getTickets(e,i,r,p)}getTicketCategories(){return this.adapter.getTicketCategories()}getTicketAssociatedObjects(e){return this.adapter.getTicketAssociatedObjects(e)}createTicket(e,i){return this.adapter.createTicket(e,i)}createTicketEvent(e,i,r){return this.adapter.createTicketEvent(e,i,r)}uploadAttachment(e,i,r,p){return this.adapter.uploadAttachment(e,i,r,p)}downloadAttachment(e,i,r,p){return this.adapter.downloadAttachment(e,i,r,p)}};t.\u0275fac=function(i){return new(i||t)(v(_e))},t.\u0275prov=F({token:t,factory:t.\u0275fac});let n=t;return n})(),yi=new z("CustomerTicketingDetailsNormalizer"),Si=new z("CustomerTicketingEventNormalizer"),mt=new z("CustomerTicketingFileNormalizer"),bi=new z("CustomerTicketingListNormalizer"),_i=new z("CustomerTicketingCategoryNormalizer"),Ii=new z("CustomerTicketingAssociatedObjectsNormalizer"),Di=new z("CustomerTicketingCreateNormalizer"),Ci=(()=>{let t=class t{getTicketCategoriesQueryReloadEvents(){return[si]}getTicketCategoriesQueryResetEvents(){return[ci]}getTicketAssociatedObjectsQueryReloadEvents(){return[li]}getTicketAssociatedObjectsQueryResetEvents(){return[ai]}getTicketQueryReloadEvents(){return[He]}getTicketQueryResetEvents(){return[ei]}getTicketsQueryReloadEvents(){return[ii]}getTicketsQueryResetEvents(){return[ti]}getTicketsQuery$(e,i,r){return this.queryService.create(()=>this.customerTicketingListPreConditions().pipe(Z(p=>this.customerTicketingConnector.getTickets(p,e,i,r))),{reloadOn:this.getTicketsQueryReloadEvents(),resetOn:this.getTicketsQueryResetEvents()})}customerTicketingPreConditions(){return oe([this.userIdService.getUserId(),this.routingService.getParams().pipe(k(e=>e.ticketCode),Ct())]).pipe(K(1),k(([e,i])=>{if(!e)throw new Error("Customer ticketing pre conditions not met");return[e,i]}))}customerTicketingListPreConditions(){return this.userIdService.getUserId().pipe(K(1),k(e=>{if(!e)throw new Error("Customer ticketing list pre conditions not met");return e}))}constructor(e,i,r,p,T,B){this.queryService=e,this.commandService=i,this.userIdService=r,this.customerTicketingConnector=p,this.routingService=T,this.eventService=B,this.createTicketCommand=this.commandService.create(y=>this.customerTicketingPreConditions().pipe(Z(([$])=>this.customerTicketingConnector.createTicket($,y)),M(()=>{this.eventService.dispatch({},pi)})),{strategy:Ee.Queue}),this.createTicketEventCommand=this.commandService.create(y=>this.customerTicketingPreConditions().pipe(Z(([$,ge])=>this.customerTicketingConnector.createTicketEvent($,ge,y.ticketEvent).pipe(M(()=>{y.ticketEvent.toStatus?.id==="CLOSED"?this.eventService.dispatch({},oi):y.containsAttachment||(y.ticketEvent.toStatus?.id==="OPEN"||y.ticketEvent.toStatus?.id==="INPROCESS"?this.eventService.dispatch({},ri):this.eventService.dispatch({},ni))})))),{strategy:Ee.Queue}),this.uploadAttachmentCommand=this.commandService.create(y=>this.customerTicketingPreConditions().pipe(Z(([$,ge])=>this.customerTicketingConnector.uploadAttachment($,y.ticketId??ge,y.eventCode,y.file).pipe(M(()=>this.eventService.dispatch({},di))))),{strategy:Ee.Queue}),this.downloadAttachmentCommand=this.commandService.create(y=>this.customerTicketingPreConditions().pipe(Z(([$,ge])=>this.customerTicketingConnector.downloadAttachment($,ge,y.eventCode,y.attachmentId))),{strategy:Ee.Queue}),this.getTicketQuery$=this.queryService.create(()=>this.customerTicketingPreConditions().pipe(Z(([y,$])=>this.customerTicketingConnector.getTicket(y,$))),{reloadOn:this.getTicketQueryReloadEvents(),resetOn:this.getTicketQueryResetEvents()}),this.getTicketCategoriesQuery=this.queryService.create(()=>this.customerTicketingConnector.getTicketCategories(),{reloadOn:this.getTicketCategoriesQueryReloadEvents(),resetOn:this.getTicketCategoriesQueryResetEvents()}),this.getTicketAssociatedObjectsQuery=this.queryService.create(()=>this.customerTicketingPreConditions().pipe(Z(([y])=>this.customerTicketingConnector.getTicketAssociatedObjects(y))),{reloadOn:this.getTicketAssociatedObjectsQueryReloadEvents(),resetOn:this.getTicketAssociatedObjectsQueryResetEvents()})}getTicketAssociatedObjectsState(){return this.getTicketAssociatedObjectsQuery.getState()}getTicketAssociatedObjects(){return this.getTicketAssociatedObjectsState().pipe(kt(e=>e?.error?ft(e.error):Ie(e)),k(e=>e.data??[]))}getTicketCategoriesState(){return this.getTicketCategoriesQuery.getState()}getTicketCategories(){return this.getTicketCategoriesState().pipe(k(e=>e.data??[]))}getTicketState(){return this.getTicketQuery$.getState()}getTicket(){return this.getTicketState().pipe(k(e=>e.data))}createTicket(e){return this.createTicketCommand.execute(e)}getTicketsState(e,i,r){return this.getTicketsQuery$(e,i,r).getState()}getTickets(e,i,r){return this.getTicketsState(e,i,r).pipe(k(p=>p.data))}createTicketEvent(e,i=!1){return this.createTicketEventCommand.execute({ticketEvent:e,containsAttachment:i})}uploadAttachment(e,i,r){return this.uploadAttachmentCommand.execute({file:e,eventCode:i,ticketId:r})}downloadAttachment(e,i){return this.downloadAttachmentCommand.execute({eventCode:e,attachmentId:i})}};t.\u0275fac=function(i){return new(i||t)(v(Bt),v(Nt),v(Rt),v(Ei),v(ie),v(Ce))},t.\u0275prov=F({token:t,factory:t.\u0275fac});let n=t;return n})(),xn=[Ci,{provide:I,useExisting:Ci}];function vi(n){return n.reason==="notFound"&&n.type==="NotFoundError"}var En=(()=>{let t=class t extends it{constructor(e,i,r){super(e,r),this.globalMessageService=e,this.routingService=i,this.platformId=r,this.responseStatus=jt.NOT_FOUND}getPriority(){return 0}hasMatch(e){return super.hasMatch(e)&&this.isCustomerTicketingDetailsRoute()&&this.getErrors(e).some(vi)}handleError(e,i){this.handleTicketNotFoundError(e,i)}isCustomerTicketingDetailsRoute(){return Mt(this.routingService.getRouterState())?.state?.semanticRoute==="supportTicketDetails"}handleTicketNotFoundError(e,i){this.getErrors(i).filter(r=>vi(r)).forEach(()=>{this.routingService.go({cxRoute:"supportTickets"}),this.globalMessageService.add({key:"customerTicketingDetails.ticketNotFound"},ve.MSG_TYPE_ERROR)})}getErrors(e){return e.error?.errors||[]}};t.\u0275fac=function(i){return new(i||t)(v(Oe),v(ie),v(yt))},t.\u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),xi=(()=>{let t=class t extends et{constructor(e,i,r,p,T,B){super(),this.translationService=e,this.activeCartFacade=i,this.basePageMetaResolver=r,this.customerTicketingFacade=p,this.translation=T,this.semanticPath=B,this.CUSTOMER_SERVICE_TRANSLATION_KEY="customerTicketing.customerService",this.CUSTOMER_SERVICE_SEMANTIC_ROUTE="supportTickets",this.customerServiceBreadCrumb$=this.translation.translate(this.CUSTOMER_SERVICE_TRANSLATION_KEY).pipe(k(y=>[{label:y,link:this.semanticPath.get(this.CUSTOMER_SERVICE_SEMANTIC_ROUTE)}])),this.pageType=It.CONTENT_PAGE,this.pageUid="support-ticket-details"}resolveTitle(){return this.basePageMetaResolver.resolveTitle()}resolveHeading(){return this.customerTicketingFacade.getTicket().pipe(k(e=>e?.subject||""))}resolveDescription(){return this.basePageMetaResolver.resolveDescription()}resolveRobots(){return this.basePageMetaResolver.resolveRobots()}resolveBreadcrumbs(){return oe([this.customerServiceBreadCrumb$,this.basePageMetaResolver.resolveBreadcrumbs()]).pipe(k(([e,i=[]])=>{let[r,...p]=i;return[r,...e,...p]}))}};t.\u0275fac=function(i){return new(i||t)(v(Y),v(Ht),v(Lt),v(I),v(Y),v(At))},t.\u0275prov=F({token:t,factory:t.\u0275fac,providedIn:"root"});let n=t;return n})(),Ri=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({providers:[...xn,Ei,xi,{provide:it,useExisting:En,multi:!0},{provide:et,useExisting:xi,multi:!0}]});let n=t;return n})();var yn=(()=>{let t=class t{constructor(e,i,r){this.http=e,this.occEndpoints=i,this.converter=r,this.logger=A(Ft)}getTicketAssociatedObjects(e){return this.http.get(this.getTicketAssociatedObjectsEndpoint(e)).pipe(R(i=>{throw G(i,this.logger)}),k(i=>i.ticketAssociatedObjects??[]),this.converter.pipeableMany(Ii))}getTicketAssociatedObjectsEndpoint(e){return this.occEndpoints.buildUrl("getTicketAssociatedObjects",{urlParams:{customerId:e}})}getTicketCategories(){return this.http.get(this.getTicketCategoriesEndpoint()).pipe(R(e=>{throw G(e,this.logger)}),k(e=>e.ticketCategories??[]),this.converter.pipeableMany(_i))}getTicketCategoriesEndpoint(){return this.occEndpoints.buildUrl("getTicketCategories")}getTicket(e,i){return this.http.get(this.getTicketEndpoint(e,i)).pipe(R(r=>{throw G(r,this.logger)}),M(r=>r.ticketEvents?.reverse()),this.converter.pipeable(yi))}getTicketEndpoint(e,i){return this.occEndpoints.buildUrl("getTicket",{urlParams:{customerId:e,ticketId:i}})}createTicket(e,i){return this.http.post(this.getCreateTicketEndpoint(e),i,{headers:new Xe().set("Content-Type","application/json")}).pipe(R(r=>{throw G(r,this.logger)}),this.converter.pipeable(Di))}getCreateTicketEndpoint(e){return this.occEndpoints.buildUrl("createTicket",{urlParams:{customerId:e}})}getTickets(e,i,r,p){return this.http.get(this.getTicketsEndpoint(e,i,r,p)).pipe(R(T=>{throw G(T,this.logger)}),this.converter.pipeable(bi))}getTicketsEndpoint(e,i,r,p){return this.occEndpoints.buildUrl("getTickets",{urlParams:{customerId:e},queryParams:{pageSize:i,currentPage:r,sort:p}})}createTicketEvent(e,i,r){return this.http.post(this.getCreateTicketEventEndpoint(e,i),r,{headers:new Xe().set("Content-Type","application/json")}).pipe(R(p=>{throw G(p,this.logger)}),this.converter.pipeable(Si))}getCreateTicketEventEndpoint(e,i){return this.occEndpoints.buildUrl("createTicketEvent",{urlParams:{customerId:e,ticketId:i}})}uploadAttachment(e,i,r,p){let T=new FormData;return T.append("ticketEventAttachment",p),this.http.post(this.getUploadAttachmentEndpoint(e,i,r),T).pipe(R(B=>{throw G(B,this.logger)}),this.converter.pipeable(mt))}getUploadAttachmentEndpoint(e,i,r){return this.occEndpoints.buildUrl("uploadAttachment",{urlParams:{customerId:e,ticketId:i,eventCode:r}})}downloadAttachment(e,i,r,p){let T={responseType:"blob"};return this.http.get(this.getDownloadAttachmentEndpoint(e,i,r,p),T).pipe(R(B=>{throw G(B,this.logger)}),this.converter.pipeable(mt))}getDownloadAttachmentEndpoint(e,i,r,p){return this.occEndpoints.buildUrl("downloadAttachment",{urlParams:{customerId:e,ticketId:i,eventCode:r,attachmentId:p}})}};t.\u0275fac=function(i){return new(i||t)(v(_t),v(Ot),v(wt))},t.\u0275prov=F({token:t,factory:t.\u0275fac});let n=t;return n})(),Sn={backend:{occ:{endpoints:{getTicket:"users/${customerId}/tickets/${ticketId}",getTickets:"users/${customerId}/tickets",createTicketEvent:"users/${customerId}/tickets/${ticketId}/events",getTicketCategories:"/ticketCategories",getTicketAssociatedObjects:"users/${customerId}/ticketAssociatedObjects",createTicket:"users/${customerId}/tickets",uploadAttachment:"/users/${customerId}/tickets/${ticketId}/events/${eventCode}/attachments",downloadAttachment:"/users/${customerId}/tickets/${ticketId}/events/${eventCode}/attachments/${attachmentId}"}}}},Fi=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({providers:[N(Sn),{provide:_e,useClass:yn}],imports:[j]});let n=t;return n})();var Tr=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=_({type:t}),t.\u0275inj=b({imports:[ki,Ri,Fi]});let n=t;return n})();export{Tr as CustomerTicketingModule};
